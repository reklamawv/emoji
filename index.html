<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }

        canvas {
            border: 1px solid black;
            margin: 10px 0;
        }

        #emojiPicker {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
        }

        #brushSizeContainer {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }
    </style>
    <script src="https://vk.com/js/api/mobile_sdk.js"  type="text/javascript"></script>
</head>

<body>
<script language="javascript">
            VK.init({
              apiId: 51777648
            });
            </script>
    <h1>–ì—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–π —Ä–µ–¥–∞–∫—Ç–æ—Ä</h1>
    <canvas id="canvas" width="500" height="500"></canvas>
    <div id="brushSizeContainer" class="form-group">
        <label for="brushSize" style="margin-right: 10px;">–†–∞–∑–º–µ—Ä:</label>
        <input type="range" id="brushSize" class="form-control-range" min="1" max="500" value="30">
        <div id="coordinates" style="margin-bottom: 10px;">–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: (X, Y)</div>
    </div>

    <div id="emojiPicker" class="form-group">
        <label for="emojiSelect" style="margin-right: 10px;">–≠–º–æ–¥–∂–∏:</label>
        <select id="emojiSelect" class="form-control"></select>
        <input type="text" id="emojiInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —ç–º–æ–¥–∂–∏" class="form-control" style="width: 150px;">
        <button id="addCustomEmojiBtn" class="btn btn-secondary">–î–æ–±–∞–≤–∏—Ç—å</button>
    </div>

    <div class="form-group">
        <label for="opacityRange" style="margin-right: 10px;">–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å:</label>
        <input type="range" id="opacityRange" class="form-control-range" min="0.1" max="1" step="0.1" value="1">
    </div>
    <div class="form-group1">
    <button id="eraserBtn" class="btn btn-danger mb-2">–õ–∞—Å—Ç–∏–∫</button>
    <button id="undoBtn" class="btn btn-warning mb-2">–û—Ç–º–µ–Ω–∞</button>
    <button id="saveBtn" class="btn btn-primary mb-2">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </div>
    

    <script>
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let painting = false;
        let brushSize = document.getElementById('brushSize').value;
        let brushEmoji = document.getElementById('emojiSelect').value; // –ò–∑–Ω–∞—á–∞–ª—å–Ω—ã–π —ç–º–æ–¥–∂–∏
        let isEraser = false; // –§–ª–∞–≥ –¥–ª—è –ª–∞—Å—Ç–∏–∫–∞
        let opacity = document.getElementById('opacityRange').value; // –ò–∑–Ω–∞—á–∞–ª—å–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
        let actions = []; // –°–ø–∏—Å–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω—ã

        // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —ç–º–æ–¥–∂–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const defaultEmojiIndex = 0; // –ò–Ω–¥–µ–∫—Å —ç–º–æ–¥–∂–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        document.getElementById('emojiSelect').selectedIndex = defaultEmojiIndex;
        brushEmoji = document.getElementById('emojiSelect').value; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        function startPosition(e) {
            painting = true;
            draw(e);
        }

        function endPosition() {
            painting = false;
            ctx.beginPath();
        }

        function draw(e) {
             // –û–±–Ω–æ–≤–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–∞ —ç–∫—Ä–∞–Ω–µ
             const x = e.clientX - canvas.offsetLeft;
             const y = e.clientY - canvas.offsetTop;
             document.getElementById('coordinates').textContent = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: (${Math.round(x)}, ${Math.round(y)})`;

            if (!painting) return;

            const emojiSize = brushSize; // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ä–∞–∑–º–µ—Ä –∫–∏—Å—Ç–∏ –∫–∞–∫ —Ä–∞–∑–º–µ—Ä —ç–º–æ–¥–∂–∏
            const emoji = isEraser ? " " : brushEmoji; // –ï—Å–ª–∏ –ª–∞—Å—Ç–∏–∫, —Ä–∏—Å—É–µ–º –ø—Ä–æ–±–µ–ª


           
            ctx.font = `${emojiSize}px Arial`; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞
            ctx.globalAlpha = isEraser ? 1 : opacity; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å

            // –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è —ç–º–æ–¥–∂–∏
            const centeredX = x - (emojiSize / 1.45);
            const centeredY = y + (emojiSize / 2.55); // –≠–º–æ–¥–∂–∏ –æ–±—ã—á–Ω–æ —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è —Å –Ω–∏–∂–Ω–µ–π —á–∞—Å—Ç—å—é –Ω–∞ —É—Ä–æ–≤–Ω–µ –ª–∏–Ω–∏–∏ —Ç–µ–∫—Å—Ç–∞

            if (isEraser) {
                ctx.clearRect(centeredX, centeredY - emojiSize, emojiSize, emojiSize); // –°—Ç–∏—Ä–∞–µ–º –ø–ª–æ—â–∞–¥—å
            } else {
                ctx.fillText(emoji, centeredX, centeredY); // –†–∏—Å—É–µ–º —ç–º–æ–¥–∂–∏
                actions.push({ emoji, x: centeredX, y: centeredY, size: emojiSize }); // –°–æ—Ö—Ä–∞–Ω—è–µ–º –¥–µ–π—Å—Ç–≤–∏–µ –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–º–µ–Ω—ã
            }
        }

        canvas.addEventListener('mousedown', startPosition);
        canvas.addEventListener('mouseup', endPosition);
        canvas.addEventListener('mousemove', draw);

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫–∏—Å—Ç–∏
        document.getElementById('brushSize').addEventListener('input', function () {
            brushSize = this.value;
        });

        // –ò–∑–º–µ–Ω–µ–Ω–∏–µ —ç–º–æ–¥–∂–∏
        document.getElementById('emojiSelect').addEventListener('change', function () {
            brushEmoji = this.value; // –ü–æ–ª—É—á–∞–µ–º —ç–º–æ–¥–∂–∏ –∏–∑ –≤—ã–ø–∞–¥–∞—é—â–µ–≥–æ —Å–ø–∏—Å–∫–∞
        });

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ —ç–º–æ–¥–∂–∏
        document.getElementById('addCustomEmojiBtn').addEventListener('click', function () {
            brushEmoji = document.getElementById('emojiInput').value; // –ü–æ–ª—É—á–∞–µ–º —ç–º–æ–¥–∂–∏ –∏–∑ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—è
        });

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —É—Ä–æ–≤–Ω—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
        document.getElementById('opacityRange').addEventListener('input', function () {
            opacity = this.value; // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç–∏
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –Ω–∞ –∫–Ω–æ–ø–∫–µ –ª–∞—Å—Ç–∏–∫–∞
        document.getElementById('eraserBtn').addEventListener('click', function () {
            isEraser = !isEraser; // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º —Ä–µ–∂–∏–º –ª–∞—Å—Ç–∏–∫–∞
            this.classList.toggle('btn-danger');
            this.classList.toggle('btn-success');
            this.textContent = isEraser ? "–ö–∏—Å—Ç—å" : "–õ–∞—Å—Ç–∏–∫"; // –ò–∑–º–µ–Ω—è–µ–º —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–µ
        });

        // –§—É–Ω–∫—Ü–∏—è –æ—Ç–º–µ–Ω—ã –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –¥–µ–π—Å—Ç–≤–∏—è
        document.getElementById('undoBtn').addEventListener('click', () => {
            if (actions.length > 0) {
                actions.pop(); // –£–±–∏—Ä–∞–µ–º –ø–æ—Å–ª–µ–¥–Ω–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
                redrawCanvas(); // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞–Ω–≤–∞—Å
            }
        });

        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –∫–∞–Ω–≤–∞—Å–∞ —Å —É—á–µ—Ç–æ–º —Ç–µ–∫—É—â–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π
        function redrawCanvas() {
            ctx.clearRect(0, 0, canvas.width, canvas.height); // –û—á–∏—â–∞–µ–º –∫–∞–Ω–≤–∞—Å
            actions.forEach(action => {
                ctx.font = `${action.size}px Arial`;
                ctx.globalAlpha = opacity; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ç–µ–∫—É—â—É—é –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å
                ctx.fillText(action.emoji, action.x, action.y); // –†–∏—Å—É–µ–º —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ —ç–º–æ–¥–∂–∏
            });
        }

        document.getElementById('saveBtn').addEventListener('click', () => {
            const dataURL = canvas.toDataURL("image/png");
            const link = document.createElement('a');
            link.href = dataURL;
            link.download = 'drawing.png';
            link.click();
        });

        // –°–æ–∑–¥–∞–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —ç–º–æ–¥–∂–∏
        const emojis = [
            "üòÄ", "üòÉ", "üòÑ", "üòÅ", "üòÜ", "üòÖ", "üòÇ",
            "ü§£", "üòú", "üòé", "üòç", "üòè", "üò£", "üò¨",
            "üò≥", "üò±", "üòµ", "üò∂", "üòá", "üéâ", "üíñ",
            "üåà", "üå∫", "üëç", "‚úàÔ∏è", "üçÄ", "üç©", "üéà",
            // –¥–æ–±–∞–≤—å—Ç–µ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —ç–º–æ–¥–∂–∏ –ø–æ –≤–∞—à–µ–º—É –∂–µ–ª–∞–Ω–∏—é
        ];

        const emojiSelect = document.getElementById('emojiSelect');

        emojis.forEach(emoji => {
            const option = document.createElement('option');
            option.value = emoji;
            option.textContent = emoji;
            emojiSelect.appendChild(option);
        });
    </script>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>

</html>
